<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>RodaSessionMiddleware</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>class</span>
RodaSessionMiddleware
</h1>
<ol class='paths'>
<li>
<a href="../files/lib/roda/session_middleware_rb.html">lib/roda/session_middleware.rb</a>
</li>
</ol>
<div class='parent'>
Superclass:
<strong>Object</strong>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>Session middleware that can be used in any Rack application that uses Roda&#39;s sessions plugin for encrypted and signed cookies. See <a href="Roda/RodaPlugins/Sessions.html"><code>Roda::RodaPlugins::Sessions</code></a> for details on options.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-call">call</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="RodaSessionMiddleware/RequestMethods.html">RodaSessionMiddleware::RequestMethods</a></li>
<li><a href="RodaSessionMiddleware/SessionHash.html">RodaSessionMiddleware::SessionHash</a></li>
</ol>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span>
<span class='arguments'>(app, opts)</span>

</div>
<div class='description'>

<p>Setup the middleware, passing <code>opts</code> as the <a href="Roda.html"><code>Roda</code></a> sessions plugin options.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'>    <span class="ruby-comment"># File lib/roda/session_middleware.rb</span>&#x000A;<span class="line-num">160</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="line-num">161</span>   <span class="ruby-identifier">mid</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Roda</span>)&#x000A;<span class="line-num">162</span>   <span class="ruby-identifier">mid</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:sessions</span>, <span class="ruby-identifier">opts</span>&#x000A;<span class="line-num">163</span>   <span class="ruby-ivar">@req_class</span> = <span class="ruby-identifier">mid</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaRequest</span>&#x000A;<span class="line-num">164</span>   <span class="ruby-ivar">@req_class</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-constant">RequestMethods</span>)&#x000A;<span class="line-num">165</span>   <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>&#x000A;<span class="line-num">166</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-call'>
<a name='method-i-call'></a>
<div class='synopsis'>
<span class='name'>call</span>
<span class='arguments'>(env)</span>

</div>
<div class='description'>

<p>Initialize the session hash in the environment before calling the next application, and if the session has been loaded after the result has been returned, then persist the session in the cookie.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-call-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-call-source'>    <span class="ruby-comment"># File lib/roda/session_middleware.rb</span>&#x000A;<span class="line-num">171</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call</span>(<span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">172</span>   <span class="ruby-identifier">session</span> = <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;rack.session&#39;</span>] = <span class="ruby-constant">SessionHash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@req_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">env</span>))&#x000A;<span class="line-num">173</span> &#x000A;<span class="line-num">174</span>   <span class="ruby-identifier">res</span> = <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">175</span> &#x000A;<span class="line-num">176</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">loaded?</span>&#x000A;<span class="line-num">177</span>     <span class="ruby-identifier">session</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">persist_session</span>(<span class="ruby-identifier">res</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">session</span>.<span class="ruby-identifier">data</span>)&#x000A;<span class="line-num">178</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">179</span> &#x000A;<span class="line-num">180</span>   <span class="ruby-identifier">res</span>&#x000A;<span class="line-num">181</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
